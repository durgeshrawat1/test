# Custom Scalars
scalar DateTime
scalar Timestamp
scalar JSON
scalar Date

interface DynamoDbBase {
  PK: ID!
  SK: ID!
  ExpiresAfter: Timestamp
}

type Document implements DynamoDbBase {
  PK: ID!
  SK: ID!
  ObjectKey: ID
  ObjectStatus: String
  InitialEventTime: DateTime
  QueuedTime: DateTime
  WorkflowStartTime: DateTime
  CompletionTime: DateTime
  WorkflowExecutionArn: String
  WorkflowStatus: String
  PageCount: Int
  Sections: [Section]
  Pages: [Page]
  Metering: JSON
  EvaluationReportUri: String
  EvaluationStatus: String
  SummaryReportUri: String
  ExpiresAfter: Timestamp
  HITLStatus: String
  HITLReviewURL: String
}

type Section {
  Id: String
  PageIds: [Int]
  Class: String
  OutputJSONUri: String
  ConfidenceThresholdAlerts: [ConfidenceThresholdAlert]
}

type ConfidenceThresholdAlert {
  attributeName: String
  confidence: Float
  confidenceThreshold: Float
}

type Page {
  Id: Int
  Class: String
  ImageUri: String
  TextUri: String
  TextConfidenceUri: String
}

type DocumentList {
  Documents: [DocumentListItem]
  nextToken: String
}

type DocumentListItem implements DynamoDbBase {
  PK: ID!
  SK: ID!
  ObjectKey: ID
  InitialEventTime: DateTime
  ExpiresAfter: Timestamp
  HITLStatus: String
  HITLReviewURL: String
}

type ConfigurationResponse {
  Schema: JSON
  Default: JSON
  Custom: JSON
}

input CreateDocumentInput {
  ObjectKey: ID
  ObjectStatus: String
  InitialEventTime: DateTime
  QueuedTime: DateTime
  ExpiresAfter: Timestamp
}

type CreateDocumentOutput {
  ObjectKey: ID
}

type PresignedUrlResponse {
  presignedUrl: String!
  objectKey: String!
  usePostMethod: String!
}

input UpdateDocumentInput {
  ObjectKey: ID!
  ObjectStatus: String
  QueuedTime: DateTime
  WorkflowStartTime: DateTime
  CompletionTime: DateTime
  WorkflowExecutionArn: String
  WorkflowStatus: String
  PageCount: Int
  Sections: [SectionInput]
  Pages: [PageInput]
  Metering: JSON
  EvaluationReportUri: String
  EvaluationStatus: String
  SummaryReportUri: String
  HITLStatus: String
  HITLReviewURL: String
}

input SectionInput {
  Id: String
  PageIds: [Int]
  Class: String
  OutputJSONUri: String
  ConfidenceThresholdAlerts: [ConfidenceThresholdAlertInput]
}

input ConfidenceThresholdAlertInput {
  attributeName: String
  confidence: Float
  confidenceThreshold: Float
}

input PageInput {
  Id: Int
  Class: String
  ImageUri: String
  TextUri: String
  TextConfidenceUri: String
}

type CopyToBaselineResponse {
  success: Boolean!
  message: String
}

type FileContentsResponse {
  content: String!
  contentType: String!
  size: Int!
  isBinary: Boolean
}

type StepFunctionExecutionStep {
  name: String!
  type: String!
  status: String!
  startDate: DateTime
  stopDate: DateTime
  input: JSON
  output: JSON
  error: String
  mapIterations: Int
  mapIterationDetails: [StepFunctionExecutionStep]
}

type StepFunctionExecutionResponse {
  executionArn: String!
  status: String!
  startDate: DateTime
  stopDate: DateTime
  input: JSON
  output: JSON
  error: String
  steps: [StepFunctionExecutionStep]
}

type AnalyticsJob {
  jobId: ID!
  status: String!
  query: String!
  createdAt: DateTime!
  completedAt: DateTime
  result: String
  error: String
  agent_messages: String
}

type AnalyticsJobConnection {
  items: [AnalyticsJob]
  nextToken: String
}

type Mutation {
  createDocument(input: CreateDocumentInput!): CreateDocumentOutput
  updateDocument(input: UpdateDocumentInput!): Document
  deleteDocument(objectKeys: [String!]!): Boolean!
  updateConfiguration(customConfig: JSON!): Boolean
  uploadDocument(fileName: String!, contentType: String, prefix: String, bucket: String): PresignedUrlResponse!
  copyToBaseline(objectKey: String!): CopyToBaselineResponse!
  reprocessDocument(objectKeys: [String!]!): Boolean!
  publishStepFunctionExecutionUpdate(executionArn: String!, data: JSON!): StepFunctionExecutionResponse
  updateAnalyticsJobStatus(jobId: ID!, status: String!, userId: String!, result: String): Boolean
  deleteAnalyticsJob(jobId: ID!): Boolean
}

type Query {
  getDocument(ObjectKey: ID!): Document
  listDocuments(startDateTime: DateTime, endDateTime: DateTime): DocumentList
  listDocumentsDateHour(date: Date, hour: Int): DocumentList
  listDocumentsDateShard(date: Date, shard: Int): DocumentList
  getFileContents(s3Uri: String!): FileContentsResponse
  getConfiguration: ConfigurationResponse
  queryKnowledgeBase(input: String!, sessionId: String): String
  chatWithDocument(s3Uri: String!, prompt: String!, history: JSON!, modelId: String!): String
  getStepFunctionExecution(executionArn: String!): StepFunctionExecutionResponse
  submitAnalyticsQuery(query: String!): AnalyticsJob
  getAnalyticsJobStatus(jobId: ID!): AnalyticsJob
  listAnalyticsJobs(limit: Int, nextToken: String): AnalyticsJobConnection
}

type Subscription {
  onCreateDocument: CreateDocumentOutput
  onUpdateDocument: Document
  onStepFunctionExecutionUpdate(executionArn: String!): StepFunctionExecutionResponse
  onAnalyticsJobComplete(jobId: ID!): Boolean
}

schema {
  query: Query
  mutation: Mutation
  subscription: Subscription
}
