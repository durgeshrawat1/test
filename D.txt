resource "null_resource" "build_lambda_layer" {
  provisioner "local-exec" {
    command = <<EOT
      mkdir -p ${path.module}/build_artifacts
      cd ${path.module}/lib/idp_common_pkg && \
      zip -r ${path.module}/build_artifacts/idp_commons_layer.zip idp_commons > /dev/null
    EOT
  }
}



resource "aws_lambda_layer_version" "idp_commons_layer" {
  layer_name          = "idp_commons_layer"
  compatible_runtimes = ["python3.9"]
  filename            = "${path.module}/build_artifacts/idp_commons_layer.zip"
  source_code_hash    = filebase64sha256("${path.module}/build_artifacts/idp_commons_layer.zip")

  depends_on = [null_resource.build_lambda_layer]
}
