initContainers:
  - name: wait-for-postgres
    image: busybox:1.36.1-uclibc
    command: ["/bin/sh", "-c"]
    args:
      - |
        echo "Waiting for Postgres..."
        while true; do
          echo "Checking DNS..."
          nslookup postgres-service.n8n.svc.cluster.local >/dev/null 2>&1 || { echo "DNS not ready"; sleep 2; continue; }

          echo "Checking TCP..."
          nc -z postgres-service.n8n.svc.cluster.local 5432 && break

          echo "Postgres not reachable yet"
          sleep 2
        done
        echo "Postgres is up!"
